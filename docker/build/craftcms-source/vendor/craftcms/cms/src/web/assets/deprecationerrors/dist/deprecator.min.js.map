{"version":3,"sources":["deprecationerrors/src/deprecator.js"],"names":["$","Garnish","Base","extend","$clearAllBtn","Deprecator","$table","$tracesModalBody","this","$noLogsMessage","addListener","find","Craft","postActionRequest","onClearAll","viewLogTraces","ev","tracesModal","$container","addClass","empty","show","appendTo","$bod","resizable","Modal","removeClass","data","response","textStatus","html","console","log","currentTarget","closest","siblings","$tr","length","remove","parent","jQuery"],"mappings":"CAAA,SAACA,GA+EG,IA3EJC,QAAAC,KAAAC,OAAA,CACAC,aAAA,KACQC,OAAU,KACVD,YAAc,KACdE,iBAFiC,KAIjCC,KAAAA,WAEMC,KAAAJ,aAAWJ,EAAA,aACRI,KAAAA,OAAeJ,EAAE,sBACjBM,KAALG,eAAgBT,EAAA,WAGXU,KAAAA,YAAiBN,KAAAA,aAAc,QAAS,gBACxCM,KAAAA,YAAiBJ,KAALA,OAAiBK,KAAA,eAAgB,QAAS,iBACtDD,KAAAA,YAAiBJ,KAALA,OAAiBK,KAAA,WAAY,QAAS,cAIvDC,aAAMC,WACDC,MAAAA,kBAAL,2CAlB6BN,KAAAM,cAuBzBC,cAAc,SAAKC,GACnB,GAAKT,KAAAA,YASRC,KAAAS,YAAAC,WAAAC,SAAA,WAFGX,KAAKD,iBAAiBa,QAIlBZ,KAAGS,YAAAI,WAXmB,CAErBJ,IAAAA,EAAkBhB,EAAAA,4CAA0BqB,SAAArB,QAAAsB,MAC7CC,KAAWjB,iBAAAP,EAAA,oCAAAsB,SAAAJ,GAEZV,KAAAS,YAAA,IAAAhB,QAAAwB,MAAAP,EAAA,CACED,WAAYC,IASfL,IAAAA,EAAAA,CACGI,MAAAA,EAAYC,EAAAA,eAAWQ,QAAY,MAAxCC,KAAA,OAGIf,MAAKL,kBAAL,+CAAAoB,EAAA,CAAAC,EAAAC,KACHrB,KAAAS,YAAAC,WAAAQ,YAAA,WA5CwB,YAAAG,GAgDtBrB,KAASQ,iBAAIc,KAAAF,EAAAE,SAOpBlB,UAAMC,SAAAA,GACFkB,IAAQC,EAAIhC,EAAAgB,EAAAiB,eAAZC,QAAmCN,MALnCD,EAAO,CAQHQ,MAAJC,EAAeC,KAAnB,OAGIzB,MAAKE,kBAAL,qCAAAa,GAAA,SAAAC,EAAAC,GACHE,QAAAC,IAAA,sBAAAJ,EAAAC,MAIIzB,EAAAA,WAALiC,OACK/B,EAAOgC,SAEf9B,KAAAM,cAJDA,WAAY,WACRN,KAAKJ,aAAamC,SAASD,SAC3B9B,KAAKF,OAAOgC,SACZ9B,KAAKC,eAAeiB,YAAY,cA3E5C,CAgFGc","file":"deprecator.min.js","sourcesContent":["(function($) {\n    /** global: Craft */\n    /** global: Garnish */\n    /**\n     * Deprecator class\n     */\n    var Deprecator = Garnish.Base.extend({\n        $clearAllBtn: null,\n        $table: null,\n        tracesModal: null,\n        $tracesModalBody: null,\n\n        init: function() {\n            this.$clearAllBtn = $('#clearall');\n            this.$table = $('#deprecationerrors');\n            this.$noLogsMessage = $('#nologs');\n\n            this.addListener(this.$clearAllBtn, 'click', 'clearAllLogs');\n            this.addListener(this.$table.find('.viewtraces'), 'click', 'viewLogTraces');\n            this.addListener(this.$table.find('.delete'), 'click', 'deleteLog');\n        },\n\n        clearAllLogs: function() {\n            Craft.postActionRequest('utilities/delete-all-deprecation-errors');\n            this.onClearAll();\n        },\n\n        viewLogTraces: function(ev) {\n            if (!this.tracesModal) {\n                var $container = $('<div id=\"traces\" class=\"modal loading\"/>').appendTo(Garnish.$bod);\n                this.$tracesModalBody = $('<div class=\"body\" tabindex=\"0\"/>').appendTo($container);\n\n                this.tracesModal = new Garnish.Modal($container, {\n                    resizable: true\n                });\n            } else {\n                this.tracesModal.$container.addClass('loading');\n                this.$tracesModalBody.empty();\n                this.tracesModal.show();\n            }\n\n            var data = {\n                logId: $(ev.currentTarget).closest('tr').data('id')\n            };\n\n            Craft.postActionRequest('utilities/get-deprecation-error-traces-modal', data, (response, textStatus) => {\n                this.tracesModal.$container.removeClass('loading');\n\n                if (textStatus === 'success') {\n                    this.$tracesModalBody.html(response.html);\n                }\n            });\n        },\n\n        deleteLog: function(ev) {\n            var $tr = $(ev.currentTarget).closest('tr');\n\n            var data = {\n                logId: $tr.data('id')\n            };\n\n            Craft.postActionRequest('utilities/delete-deprecation-error', data, function(response, textStatus) {\n                console.log('response/textStatus', response, textStatus);\n            });\n\n            if ($tr.siblings().length) {\n                $tr.remove();\n            } else {\n                this.onClearAll();\n            }\n        },\n\n        onClearAll: function() {\n            this.$clearAllBtn.parent().remove();\n            this.$table.remove();\n            this.$noLogsMessage.removeClass('hidden');\n        }\n    });\n\n    new Deprecator();\n})(jQuery);\n"]}