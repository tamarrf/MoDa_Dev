{"version":3,"sources":["quickpost/src/QuickPostWidget.js"],"names":["$","Craft","QuickPostWidget","Garnish","Base","extend","params","initFields","formHtml","$widget","$form","$spinner","$errorList","init","widgetId","this","initForm","find","$menuBtn","menubtn","addListener","$saveAndContinueEditingBtn","data","menu","$container","preventDefault","saveAndContinueEditing","handleFormSubmit","callback","event","loading","save","onSave","bind","formData","getPostData","postActionRequest","children","remove","textStatus","enabled","cp","response","addClass","errors","success","attribute","displayNotice","t","displayError","error","appendTo","insertAfter","hasOwnProperty","i","length","widget","url","cpEditUrl","title","$newForm","dateCreated","username","RecentEntriesWidget","instances","sectionId","addEntry","authorUsername","gotoEntry","redirectTo","jQuery"],"mappings":"CAAA,SAACA,GAEGC,MAAAC,gBAAAC,QAAAC,KAAAC,OAAA,CACMH,OAAAA,KACFI,WADwC,KAExCC,SAAY,KACZC,QAAU,KACVC,MAAS,KACTC,SALwC,KAMxCC,WANwC,KAOxCC,SAAY,EAGRC,KAAE,SAASC,EAAUR,EAAQC,EAAYC,GACpCF,KAALA,OAAAA,EACKC,KAAAA,WAAaA,EACbC,KAAAA,SAAWA,EACXC,KAAAA,QAAYT,EAAA,UAAYc,GAdOC,KAAAC,SAAAD,KAAAN,QAAAQ,KAAA,gBAqBpCD,SAAKL,SAAgBD,GAEhBH,KAAAA,MAALG,EAEIQ,KAAAA,SAAgBR,KAAMO,MAAKA,KAAA,YAG/BC,KAASC,aAGJC,IAAAA,EAAYC,KAAAA,MAAAA,KAAAA,qCA/BmBA,EAAAH,EAAAI,KAAA,WAAAC,KAAAC,WAAAP,KAAA,iBAmC9BQ,EAAAA,UAnC8BV,KAAAK,YAAAL,KAAAL,MAAA,SAAA,oBAwCxCgB,KAAAA,YAAwBL,EAAW,QAAA,2BAI/BM,iBAAWC,SAAUC,GACjBA,EAAKC,iBAERf,KAAAgB,KAAAhB,KAAAiB,OAAAC,KAAAlB,QAGDW,uBAA0B,WAEtBQ,KAAAA,KAAW/B,KAAAA,UAAQgC,KAAYpB,QACxBgB,KAAuBG,SAAUN,GAEtCQ,IAAAA,KAAAA,QAAAA,CAIErB,KAAKH,SAAT,EACIG,KAAKH,SAAWyB,YAAWC,UARnC,IAAIJ,EAAW/B,QAAQgC,YAAYpB,KAAKL,OAWhC6B,EAAUvC,EAAAK,OAAK,CAAAmC,QAAW,GAAAN,EAAAnB,KAAAT,QAEtBL,MAAMwC,kBAAiBxC,qBAAeqB,EAAf,CAAvBoB,EAAAH,KAQK,GAPLX,KAASc,SAAT,EAFJ3B,KAGOJ,SAAAgC,SAAA,UARP5B,KAAKH,YAWG8B,KAASE,WAAQP,WAAAC,SAGhB,YAAAC,EATT,GAAIG,EAASG,QAWIC,MAAAA,GAATC,cAA+BH,MAAQI,EAAA,MAAA,iBAC9BN,EAASE,QAIT,GAFJ3C,MAAAwC,GAAAQ,aAAAhD,MAAA+C,EAAA,MAAA,yBAESN,EAAUA,OAK3B,IAAA,IAAAI,KAJuBJ,KAAQ9B,aACTsC,KAAQtC,WAASuC,EAAAA,wBAA5BC,YAAArC,KAAAL,QAGXgC,EAAAE,OACJ,GAAAF,EAAAE,OAAAS,eAAAP,GAKc,IAAA,IAAAQ,EAAA,EAAAA,EAAAZ,EAAAE,OAAAE,GAAAS,OAAAD,IAAA,CACvB,IAAAJ,EAAAR,EAAAE,OAAAE,GAAAQ,GACgBtD,EAAhB,OAAAkD,EAAA,SAAAC,SAAApC,KAAAH,iBASQoB,OAAKwB,SAAOlD,GAEJmD,IAAAA,EAAazD,EAAC0D,KAAAA,UAMzB,GALWC,KAAAA,MAAOjB,YAFKkB,GAGZC,MAAAA,eAAanB,GACboB,KAAAA,SAAUpB,QAGrB,IAAAzC,MAAA8D,oBACJ,IAAA,IAAAT,EAAA,EAAAA,EAAArD,MAAA8D,oBAAAC,UAAAT,OAAAD,IAAA,CA/GmC,IAAAE,EAAAvD,MAAA8D,oBAAAC,UAAAV,GAkHpBZ,EAAAA,OAAUuB,WAAAT,EAAAlD,OAAA2D,WAAAlD,KAAAT,OAAA2D,WAC1BT,EAAAU,SAAA,CACiBxB,IAASgB,EAA1BA,UACHC,MAAAjB,EAAAiB,MArHLE,YAAAnB,EAAAmB,YAHJC,SAAApB,EAAAyB,mBAqHQC,UAAW,SAAS1B,GAEhBzC,MAAMoE,WAAW3B,EAASgB,cAvHtC,CA0HGY","file":"QuickPostWidget.min.js","sourcesContent":["(function($) {\n    /** global: Craft */\n    /** global: Garnish */\n    Craft.QuickPostWidget = Garnish.Base.extend({\n        params: null,\n        initFields: null,\n        formHtml: null,\n        $widget: null,\n        $form: null,\n        $spinner: null,\n        $errorList: null,\n        loading: false,\n\n        init: function(widgetId, params, initFields, formHtml) {\n            this.params = params;\n            this.initFields = initFields;\n            this.formHtml = formHtml;\n            this.$widget = $('#widget' + widgetId);\n\n            this.initForm(this.$widget.find('form:first'));\n        },\n\n        initForm: function($form) {\n            this.$form = $form;\n            this.$spinner = this.$form.find('.spinner');\n\n            this.initFields();\n\n            var $menuBtn = this.$form.find('> .buttons > .btngroup > .menubtn'),\n                $saveAndContinueEditingBtn = $menuBtn.data('menubtn').menu.$container.find('> ul > li > a');\n\n            $menuBtn.menubtn();\n\n            this.addListener(this.$form, 'submit', 'handleFormSubmit');\n            this.addListener($saveAndContinueEditingBtn, 'click', 'saveAndContinueEditing');\n        },\n\n        handleFormSubmit: function(event) {\n            event.preventDefault();\n\n            this.save(this.onSave.bind(this));\n        },\n\n        saveAndContinueEditing: function() {\n            this.save(this.gotoEntry.bind(this));\n        },\n\n        save: function(callback) {\n            if (this.loading) {\n                return;\n            }\n\n            this.loading = true;\n            this.$spinner.removeClass('hidden');\n\n            var formData = Garnish.getPostData(this.$form),\n                data = $.extend({enabled: 1}, formData, this.params);\n\n            Craft.postActionRequest('entries/save-entry', data, (response, textStatus) => {\n                this.loading = false;\n                this.$spinner.addClass('hidden');\n\n                if (this.$errorList) {\n                    this.$errorList.children().remove();\n                }\n\n                if (textStatus === 'success') {\n                    if (response.success) {\n                        Craft.cp.displayNotice(Craft.t('app', 'Entry saved.'));\n                        callback(response);\n                    } else {\n                        Craft.cp.displayError(Craft.t('app', 'Couldnâ€™t save entry.'));\n\n                        if (response.errors) {\n                            if (!this.$errorList) {\n                                this.$errorList = $('<ul class=\"errors\"/>').insertAfter(this.$form);\n                            }\n\n                            for (var attribute in response.errors) {\n                                if (!response.errors.hasOwnProperty(attribute)) {\n                                    continue;\n                                }\n\n                                for (var i = 0; i < response.errors[attribute].length; i++) {\n                                    var error = response.errors[attribute][i];\n                                    $('<li>' + error + '</li>').appendTo(this.$errorList);\n                                }\n                            }\n                        }\n                    }\n                }\n            });\n        },\n\n        onSave: function(response) {\n            // Reset the widget\n            var $newForm = $(this.formHtml);\n            this.$form.replaceWith($newForm);\n            Craft.initUiElements($newForm);\n            this.initForm($newForm);\n\n            // Are there any Recent Entries widgets to notify?\n            if (typeof Craft.RecentEntriesWidget !== 'undefined') {\n                for (var i = 0; i < Craft.RecentEntriesWidget.instances.length; i++) {\n                    var widget = Craft.RecentEntriesWidget.instances[i];\n                    if (!widget.params.sectionId || widget.params.sectionId == this.params.sectionId) {\n                        widget.addEntry({\n                            url: response.cpEditUrl,\n                            title: response.title,\n                            dateCreated: response.dateCreated,\n                            username: response.authorUsername\n                        });\n                    }\n                }\n            }\n        },\n\n        gotoEntry: function(response) {\n            // Redirect to the entry's edit URL\n            Craft.redirectTo(response.cpEditUrl);\n        }\n    });\n})(jQuery);\n"]}